version: "3.9"

services:
 gateway:
  build: ./server
  ports:
   - "3000:3000"
  env_file:
   - ./.env
  depends_on:
   - redis
   - ollama
  restart: unless-stopped
  deploy:
   resources:
    limits:
     memory: 512M

 frontend:
  build: ./frontend
  ports:
   - "8080:80"
  depends_on:
   - gateway
  restart: unless-stopped
  deploy:
   resources:
    limits:
     memory: 256M

 redis:
  image: redis:7-alpine
  restart: unless-stopped
  command:
   ["redis-server", "--maxmemory", "128mb", "--maxmemory-policy", "allkeys-lru"]
  deploy:
   resources:
    limits:
     memory: 256M

 ollama:
  image: ollama/ollama:latest
  volumes:
   - ollama_data:/root/.ollama
  restart: unless-stopped
  deploy:
   resources:
    limits:
     memory: 2G

volumes:
 ollama_data:
